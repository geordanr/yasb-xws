var exportObj,hideAlert,resetSubmitButton,showAlert,hasProp={}.hasOwnProperty;exportObj="undefined"!=typeof exports&&null!==exports?exports:this,exportObj.ListJugglerAPI=function(){function a(a){this.url=a,this.initSelect2(),this.initHandlers()}return a.prototype.initSelect2=function(){return $("#tourney_id").select2({placeholder:"Select a tournament",minimumInputLength:1,ajax:{url:this.url+"/api/v1/search/tournaments",type:"POST",dataType:"json",quietMillis:250,data:function(a){return{query:a}},results:function(a){var b,c,d;c=[];for(d in a)hasProp.call(a,d)&&(b=a[d],c.push({id:parseInt(d),text:b.name+" / "+b.venue+" / "+b.date}));return{results:c}}},initSelection:function(a){return function(b,c){var d;return d=b.val(),""!==d?$.get(a.url+"/api/v1/tournament/"+parseInt(d)).done(function(a){return $("#player_id").select2("enable",!0),c({id:d,text:a.tournament.name+" / "+a.tournament.date})}).fail(function(){return $("#tourney_id").select2("data",null)}).always(function(){return $("#tourney_id").select2("enable",!0)}):void 0}}(this)}),$("#player_id").select2({placeholder:"Select already registered player",allowClear:!0,query:function(a){return function(b){return $.get(a.url+"/api/v1/tournament/"+$("#tourney_id").val()+"/players").done(function(a){var c,d;return d=""===b.term?function(){var b,d,e,f;for(e=a.players,f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push({id:c.id,text:c.name});return f}():function(){var d,e,f,g;for(f=a.players,g=[],d=0,e=f.length;e>d;d++)c=f[d],-1!==c.name.toLocaleLowerCase().indexOf(b.term.toLocaleLowerCase())&&g.push({id:c.id,text:c.name});return g}(),b.callback({results:d})})}}(this)}),$("#player_id").select2("enable",!1),$("#tourney_id").select2("enable",!1)},a.prototype.initHandlers=function(){return $("#tourney_id").on("change",function(){return $("#player_id").select2("data",null),$("#player_id").select2("enable",!0)}),$("#add-list").click(function(a){return function(){return $("#add-list").hasClass("disabled")?void 0:($("#add-list").addClass("disabled"),$("#add-list").text("Submitting..."),$(".has-error").removeClass("has-error has-feedback"),hideAlert(),$.get("/"+window.location.search).done(function(b){var c,d,e,f;return f=$("#tourney_id").val(),c=$.trim($("#email").val()),d=$("#player_id").val(),e=$.trim($("#player_name").val()),function(c,d,e,f){if(""===c||""===d||""===e&&""===f){switch(!1){case""!==c:showAlert("No tournament selected."),$('label[for="#tourney_id"]').parent().addClass("has-error");break;case""!==d:showAlert("No email entered."),$("#email").parent().addClass("has-error has-feedback");break;case!(""===e||""===f):showAlert("Player not selected and no player name entered."),$("#player_name").parent().addClass("has-error has-feedback"),$('label[for="#player_id"]').parent().addClass("has-error");break;default:throw new Error("Uncaught condition")}return resetSubmitButton()}return $.post(a.url+"/api/v1/tournament/"+c+"/token",{email:d}).done(function(g){var h;return h=g.api_token,""!==f?$.ajax(a.url+"/api/v1/tournament/"+c+"/players",{method:"PUT",contentType:"application/json",data:JSON.stringify({api_token:h,players:[{name:f,xws:b}]})}).done(function(){return a.updateSessionAndRedirect(c,d)}).fail(function(a,b,c){return showAlert("Could not add new player "+f+": "+c)}).always(function(){return resetSubmitButton()}):$.ajax(a.url+"/api/v1/tournament/"+c+"/player/"+e,{method:"POST",contentType:"application/json",data:JSON.stringify({api_token:h,xws:b})}).done(function(){return a.updateSessionAndRedirect(c,d)}).fail(function(a,b,c){return showAlert("Could not add list: "+c)}).always(function(){return resetSubmitButton()})}).fail(function(){return $("#email").parent().addClass("has-error has-feedback"),showAlert("Incorrect email for that tournament.")}).always(function(){return resetSubmitButton()})}(f,c,d,e)}).fail(function(){return showAlert("Could not convert squadron to XWS format.")}).always(function(){return resetSubmitButton()}))}}(this))},a.prototype.updateSessionAndRedirect=function(a,b){return $.ajax("/juggler",{method:"POST",contentType:"application/json",data:JSON.stringify({tourney_id:a,email:b})}).done(function(b){return function(){return window.location.href=b.url+"/get_tourney_details?tourney_id="+a}}(this))},a}(),hideAlert=function(){return $("#alert").addClass("hidden")},showAlert=function(a){return $("#alert").text(a),$("#alert").removeClass("hidden")},resetSubmitButton=function(){return $("#add-list").text("Add List"),$("#add-list").removeClass("disabled")};
//# sourceMappingURL=yasb_xws.min.js.map